<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/crudService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/crudService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *  @fileOverview Methods for create, read, update and delete user data
 *
 *  @author       Georgina CÃ¡ceres
 *
 *  @module       crudService
*/

const fs = require('fs');

const service = {};

/**
 * The full path for the file where information is saved. We use a json encoded user object per line to make appending more efficient
 * @constant
 * @private
 * @static
 * @type {string}
*/
service.filePath = __dirname + '/../public/data/data.txt';

/**
 * Retrieve and return all users from the storage file.
 * @module getUsers
 * @function
 * @async
 * @static
 *
 * @returns {Object[]} The list of all users
*/
service.getUsers = () => new Promise((accept, reject) => {
    fs.readFile(service.filePath, 'utf-8', (err, data) => {
        if(err)  return reject(err);
        accept(data.split(/\r?\n/).filter(str => str).map(JSON.parse));
    });
});


/**
 * Take an object and save in a file. If no errors, returns 'Ok'
 * @module addUser
 * @function
 * @async
 * @static
 *
 * @param   {object} userData the object with user information.
 *
 * @returns {string}
*/
service.addUser = (userData) => new Promise((accept, reject) => {
    fs.appendFile(service.filePath, JSON.stringify(userData) + '\n', 'utf-8', err => {
        if (err) return reject(err);
        accept('Ok');
    });
});

/**
 * Take an array of user data and save in a file. If no errors, returns 'Ok'
 * @module saveUsers
 * @function
 * @async
 * @static
 *
 * @param   {Object[]} users Array of user data
 *
 * @returns {string}
*/
service.saveUsers = (users) => new Promise((accept, reject) => {
    fs.writeFile(service.filePath, users.map(user => JSON.stringify(user) + '\n').join(''), 'utf-8', err => {
        if (err) return reject(err);
        accept('Ok');
    });
});

/**
 * Delete a user by id. Because we are using a file for persistance, we need to load everything, modify, and save again.
 * @module deleteUser
 * @function
 * @async
 * @static
 *
 * @param   {string} id Unique ID for the user
 *
 * @returns {string}
*/
service.deleteUser = (id) => {
    return service.getUsers()
        .then(users => service.saveUsers(users.filter(user => user.id != id)));
};



/**
 * Edit a user by id. Because we are using a file for persistance, we need to load everything, modify, and save again.
 * @module editUser
 * @function
 * @async
 * @static
 *
 * @param   {Object} user user edited information.
 * @param   {number} id the user's id
 *
 * @returns {string}
*/
service.editUser = (data, id) => {
    return service.getUsers()
        .then(users => users.map( user => user.id === id ? data : user))
        .then(service.saveUsers);
};

module.exports = service;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-crudService.html">crudService</a></li><li><a href="module-Home%2520Route.html">Home Route</a></li><li><a href="module-Ping%2520API.html">Ping API</a></li><li><a href="module-User%2520API%2520and%2520Routes.html">User API and Routes</a></li><li><a href="module-userControllers.html">userControllers</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Jul 27 2018 09:54:25 GMT-0300 (Argentina Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
